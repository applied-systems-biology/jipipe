package org.hkijena.acaq5.api.traits;

import com.google.common.reflect.TypeToken;
import org.hkijena.acaq5.api.ACAQDocumentation;

import java.util.HashSet;
import java.util.Set;

/**
 * Base interface for an algorithm data trait
 * Traits are generated by data slots and accumulated over algorithm depth.
 * Algorithms can modify output traits by adding or removing them.
 */
public interface ACAQTrait {

    /**
     * Returns the name of given trait
     * @param klass
     * @return
     */
    static String getNameOf(Class<? extends ACAQTrait> klass) {
        ACAQDocumentation[] annotations = klass.getAnnotationsByType(ACAQDocumentation.class);
        if(annotations.length > 0) {
            return annotations[0].name();
        }
        else {
            return klass.getSimpleName();
        }
    }

    /**
     * Returns the description of given trait
     * @param klass
     * @return
     */
    static String getDescriptionOf(Class<? extends ACAQTrait> klass) {
        ACAQDocumentation[] annotations = klass.getAnnotationsByType(ACAQDocumentation.class);
        if(annotations.length > 0) {
            return annotations[0].description();
        }
        else {
            return null;
        }
    }

    /**
     * Returns all inherited traits marked as category
     * @param klass
     * @return
     */
    static Set<Class<? extends ACAQTrait>> getCategoriesOf(Class<? extends ACAQTrait> klass) {
        Set<Class<? extends ACAQTrait>> result = new HashSet<>();
        for(TypeToken<?> type : TypeToken.of(klass).getTypes().interfaces()) {
            if(type.getRawType().getAnnotationsByType(CategoryTrait.class).length > 0) {
                result.add((Class<? extends ACAQTrait>) type.getRawType());
            }
        }
        return result;
    }

    /**
     * Returns true if the trait is hidden from the user
     * @param klass
     * @return
     */
    static boolean isHidden(Class<? extends ACAQTrait> klass) {
        return klass.getAnnotationsByType(CategoryTrait.class).length > 0;
    }

}
